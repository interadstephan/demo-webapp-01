<div class="app-container">
  <header class="app-header">
    <h1>{{ title }}</h1>
    <div class="status-bar">
      <span class="status-badge" [class.online]="isOnline" [class.offline]="!isOnline">
        {{ isOnline ? 'Online' : 'Offline' }}
      </span>
      @if (lastSyncTime) {
        <span class="sync-time">Last sync: {{ lastSyncTime | date:'short' }}</span>
      }
      @if (isInitialized) {
        <button class="btn-sync" (click)="manualSync()" [disabled]="isSyncing">
          {{ isSyncing ? 'Syncing...' : 'Sync Now' }}
        </button>
      }
    </div>
  </header>

  @if (isSyncing && isInitialized) {
    <div class="sync-progress-bar">
      <div class="sync-progress-container">
        <div class="sync-progress-fill" [style.width.%]="syncProgress"></div>
      </div>
      <div class="sync-progress-text">
        <span>{{ syncMessage }}</span>
        @if (syncTotalItems > 0) {
          <span class="sync-progress-count">({{ syncItemsSynced }}/{{ syncTotalItems }})</span>
        }
      </div>
    </div>
  }

  @if (!isInitialized) {
    <div class="init-section">
      <h2>Initialize Application</h2>
      <div class="form-group">
        <label for="agentId">Agent ID:</label>
        <input 
          type="text" 
          id="agentId" 
          [(ngModel)]="agentId" 
          placeholder="Enter your agent ID"
          class="form-control"
        />
      </div>
      <button class="btn-primary" (click)="initializeApp()">Initialize</button>
    </div>
  }

  @if (isInitialized) {
    <div class="content">
      <section class="create-section">
        <h2>Create New Record</h2>
        <div class="form-group">
          <label for="title">Title:</label>
          <input 
            type="text" 
            id="title" 
            [(ngModel)]="newRecord.title" 
            placeholder="Enter title"
            class="form-control"
          />
        </div>
        <div class="form-group">
          <label for="description">Description:</label>
          <textarea 
            id="description" 
            [(ngModel)]="newRecord.description" 
            placeholder="Enter description"
            class="form-control"
            rows="3"
          ></textarea>
        </div>
        <div class="form-group">
          <label for="data">Data:</label>
          <textarea 
            id="data" 
            [(ngModel)]="newRecord.data" 
            placeholder="Enter data"
            class="form-control"
            rows="5"
          ></textarea>
        </div>
        <button class="btn-primary" (click)="createNewRecord()">Create Record</button>
      </section>

      <section class="articles-section">
        <h2>Articles ({{ articles.length }})</h2>
        @if (articles.length === 0) {
          <p class="no-records">No articles available. They will be synced from the server.</p>
        }
        @if (articles.length > 0) {
          <button class="btn-primary btn-view-articles" (click)="openArticlesModal()">
            View All Articles ({{ articles.length }})
          </button>
        }
      </section>

      <!-- Articles Modal -->
      @if (showArticlesModal) {
        <div class="modal-overlay" (click)="closeArticlesModal()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>All Articles ({{ filteredArticles.length }})</h2>
              <button class="btn-close" (click)="closeArticlesModal()">Ã—</button>
            </div>
            <div class="modal-search">
              <input 
                type="text" 
                [(ngModel)]="articleSearchQuery" 
                (ngModelChange)="filterArticles()"
                placeholder="Search articles by title..."
                class="search-input"
              />
            </div>
            <div class="modal-body">
              <div class="articles-grid">
                @for (article of filteredArticles; track article.id) {
                  <div class="article-card">
                    @if (article.imageData) {
                      <img 
                        [src]="'data:' + article.imageContentType + ';base64,' + article.imageData" 
                        [alt]="article.title"
                        class="article-image"
                      />
                    }
                    <div class="article-content">
                      <h3>{{ article.title }}</h3>
                      <p class="article-author">By {{ article.author }}</p>
                      <p class="article-text">{{ article.content }}</p>
                      <p class="article-date">Published: {{ article.publishedAt | date:'medium' }}</p>
                    </div>
                  </div>
                }
              </div>
              @if (filteredArticles.length === 0) {
                <p class="no-records">No articles found matching "{{ articleSearchQuery }}"</p>
              }
            </div>
          </div>
        </div>
      }

      <section class="masterdata-section">
        <h2>Settings (Master Data) ({{ masterData.length }})</h2>
        @if (masterData.length === 0) {
          <p class="no-records">No settings available. They will be synced from the server.</p>
        }
        @if (masterData.length > 0) {
          <div class="masterdata-grid">
            @for (item of masterData; track item.id) {
              <div class="masterdata-card">
                <div class="masterdata-header">
                  <h4>{{ item.key }}</h4>
                  <span class="category-badge">{{ item.category }}</span>
                </div>
                <p class="masterdata-value">{{ item.value }}</p>
                @if (item.description) {
                  <p class="masterdata-description">{{ item.description }}</p>
                }
              </div>
            }
          </div>
        }
      </section>

      <section class="records-section">
        <h2>Records ({{ records.length }})</h2>
        @if (records.length === 0) {
          <p class="no-records">No records found. Create your first record above!</p>
        }
        @for (record of records; track record.id) {
          <div class="record-card">
            <div class="record-header">
              <h3>{{ record.title }}</h3>
              <button class="btn-delete" (click)="deleteRecord(record.id)">Delete</button>
            </div>
            @if (record.description) {
              <p class="record-description">{{ record.description }}</p>
            }
            @if (record.data) {
              <div class="record-data">
                <strong>Data:</strong>
                <pre>{{ record.data }}</pre>
              </div>
            }
            <div class="record-footer">
              <small>Updated: {{ record.updatedAt | date:'short' }}</small>
            </div>
          </div>
        }
      </section>
    </div>
  }
</div>
